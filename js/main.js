// Generated by CoffeeScript 1.6.1

/*
DigiSeller-ru-api
04.07.2014 (c) http://artod.ru
*/

(function(){(function(e,t){var n,r;if(e.DigiSeller!=null){false}n={};n.$el={head:null,body:null,widget:null};n.opts={seller_id:null,host:"//shop.digiseller.ru/xml/",hashPrefix:"#!digiseller",currency:"RUR",sort:"name",rows:10,view:"list",main_view:"tile",logo_img:"",menu_purchases:true,menu_reviews:true,menu_contacts:true,imgsize_firstpage:160,imgsize_listpage:162,imgsize_infopage:163,imgsize_category:200};n.util={getUID:function(){var e;e=1;return function(){return e++}}(),enc:function(e){return encodeURIComponent(e)},prevent:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},extend:function(e,t,n){var r;for(r in t){if(!t.hasOwnProperty(r)){continue}if(n||typeof e[r]==="object"){e[r]=t[r]}}return e},getPopupParams:function(n,r){var i,s,o,u,a,f;u=typeof e.screenX!=="undefined"?e.screenX:e.screenLeft;a=typeof e.screenY!=="undefined"?e.screenY:e.screenTop;o=typeof e.outerWidth!=="undefined"?e.outerWidth:t.body.clientWidth;s=typeof e.outerHeight!=="undefined"?e.outerHeight:t.body.clientHeight-22;i=parseInt(u+(o-n)/2,10);f=parseInt(a+(s-r)/2.5,10);return"scrollbars=1, resizable=1, menubar=0, left="+i+", top="+f+", width="+n+", height="+r+", toolbar=0, status=0"},getAbsPos:function(e){var t={x:0,y:0};if(e.offsetParent)do t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;while(e);return t},scrollUp:function(){var r,i,s,o;i=t.documentElement;r=t.body;o=i&&i.scrollTop||r&&r.scrollTop||0;s=n.util.getAbsPos(n.widget.main.$el).y;if(o>s){e.scroll(null,n.util.getAbsPos(n.widget.main.$el).y)}},cookie:{get:function(e){var n=t.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return n?decodeURIComponent(n[1]):undefined},set:function(e,r,i){i=i||{};var s=i.expires;if(typeof s=="number"&&s){var o=new Date;o.setTime(o.getTime()+s*1e3);s=i.expires=o}if(s&&s.toUTCString){i.expires=s.toUTCString()}r=n.util.enc(r);var u=e+"="+r;for(var a in i){u+="; "+a;var f=i[a];if(f!==true){u+="="+f}}t.cookie=u},del:function(e){this.set(e,null,{expires:-1})}},agree:function(e,t){var r;r=n.dom.$("#digiseller-calc-rules");if(r){r.checked=e}n.opts.agree=e?1:0;n.util.cookie.set("digiseller-agree",n.opts.agree);n.popup.close();if(t){t()}}};n.dom={$:function(e,n,r){var i,s;if(!e){return}s=e.substring(0,1);i=e.substring(1);switch(s){case"#":return t.getElementById(i);case".":r=r?r:"*";if(typeof t.getElementsByClassName!=="function"){for(var o=-1,u=[],a=new RegExp("(?:^|\\s)"+i+"(?:\\s|$)"),f=n&&n.getElementsByTagName&&n.getElementsByTagName(r)||t.all||t.getElementsByTagName(r),l=f.length;++o<l;a.test(f[o].className)&&u.push(f[o]));f=null;return u}else{return(n||t).getElementsByClassName(i)}break;default:return(n||t).getElementsByTagName(e)}},attr:function(e,t,n){if(!e||typeof t==="undefined"){return false}if(typeof n!=="undefined"){e.setAttribute(t,n)}else{try{return e.getAttribute(t)}catch(r){return null}}},addEvent:function(e,t,n){var r;if(e.attachEvent){r=function(t){return n.call(e,t)};e.attachEvent("on"+t,r);return r}else if(e.addEventListener){e.addEventListener(t,n,false);return n}},removeEvent:function(e,t,n){if(e.detachEvent){e.detachEvent("on"+t,n)}else if(e.removeEventListener){e.removeEventListener(t,n,false)}},klass:function(e,t,n,r){if(!t||!e){return}if(!r){t=[t]}var i,s,o,u=new RegExp("(^|\\s)"+(e==="add"?n:n.replace(" ","|"))+"(\\s|$)","g");for(o=t.length,s=o-1;s>=0;s--){i=t[s];if(e==="add"&&u.test(i.className)){continue}i.className=e==="add"?(i.className+" "+n).replace(/\s+/g," ").replace(/(^ | $)/g,""):i.className.replace(u,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}return t},select:function(e,t){var r,i,s,o,u;if(typeof t==="undefined"){return n.dom.$("option",e)[e.selectedIndex].value}else{i=n.dom.$("option",e);for(s=o=0,u=i.length;o<u;s=++o){r=i[s];if(r.value===t+""){e.selectedIndex=s;return}}}},getStyle:function(e,r){var i,s;s=t.createElement("link");s.type="text/css";s.rel="stylesheet";s.href=e;n.$el.head.appendChild(s);i=new Image;i.onerror=function(){if(r){return r()}};i.src=e},getScript:function(e,r,i){var s,o,u;u=t.createElement("script");u.type="text/javascript";u.setAttribute("encoding","UTF-8");u.src=e;s=false;o=function(e){n.widget.loader.hide();s=true;u.onload=u.onreadystatechange=null;if(n.$el.head&&u.parentNode){n.$el.head.removeChild(u)}};u.onload=u.onreadystatechange=function(e){if(!s&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){o();if(r!=null){r()}}};u.onerror=function(e){o();if(i!=null){i}};n.widget.loader.show();n.$el.head.appendChild(u)}};n.widget={main:{$el:null,init:function(){var e;this.$el=n.dom.$("#digiseller-main");n.widget.main.$el.innerHTML="";e=function(e,t){var r,i;r=e.originalTarget||e.srcElement;i=n.dom.attr(r,"data-action");if(i&&typeof n.events[t+"-"+i]==="function"){return n.events[t+"-"+i](r,e)}};n.dom.addEvent(n.widget.main.$el,"click",function(t){return e(t,"click")})}},loader:{$el:null,timeout:null,init:function(){var e;e=t.createElement("div");e.id="digiseller-loader";e.className=e.id;e.innerHTML=n.tmpls.loader;e.style.display="none";n.$el.body.appendChild(e);this.$el=n.dom.$("#"+e.id)},show:function(){var e;clearTimeout(this.timeout);e=this;this.timeout=setTimeout(function(){return e.$el.style.display=""},1e3)},hide:function(){clearTimeout(this.timeout);this.$el.style.display="none"}},search:{$el:null,$input:null,prefix:"digiseller-search",init:function(){var t,r;this.$el=n.dom.$("#"+this.prefix);if(!this.$el){return}this.$el.innerHTML=n.tmpls.search;this.$input=n.dom.$("."+this.prefix+"-input",this.$el,"input")[0];t=n.dom.$("."+this.prefix+"-form",this.$el,"form")[0];r=this;n.dom.addEvent(t,"submit",function(t){n.util.prevent(t);e.location.hash=n.opts.hashPrefix+("/search?s="+r.$input.value)})}},category:{$el:null,isInited:false,prefix:"digiseller-category",init:function(){var e;this.$el=n.dom.$("#"+this.prefix);if(!this.$el){return}this.isInited=false;e=this;n.JSONP.get(n.opts.host+"shop_categories.asp",this.$el,{seller_id:n.opts.seller_id,format:"json"},function(t){if(!t){return false}e.$el.innerHTML=e.render(t.category);e.isInited=true;e.mark()})},mark:function(){var e;e=function(e){var t,r,i,s,o,u,a,f;r=n.dom.$("li",this.$el);if(!r.length){return}o=n.dom.$("ul",this.$el);for(u=0,a=o.length;u<a;u++){s=o[u];s.style.display="none"}o[0].style.display="";n.dom.klass("remove",r,this.prefix+"-active",true);if(!e){return}t=n.dom.$("#"+this.prefix+"-"+e);if(!t){return}n.dom.klass("add",t,this.prefix+"-active");i=t;while(i.id!==this.prefix){i.style.display="";i=i.parentNode}if((f=n.dom.$("#"+this.prefix+"-sub-"+e))!=null){f.style.display=""}};return function(t){var n,r,i;if(!this.$el){return}if(this.isInited){e.call(this,t)}else{i=this;n=0;r=setInterval(function(){if(i.isInited||n>1e3){clearInterval(r);if(i.isInited){e.call(i,t)}}n++},50)}}}(),render:function(e,t){var r,i,s,o;if(!e){return""}i="";for(s=0,o=e.length;s<o;s++){r=e[s];i+=n.tmpl(n.tmpls.category,{d:r,url:n.opts.hashPrefix+("/articles/"+r.id),id:this.prefix+("-"+r.id),sub:this.render(r.sub,r.id)})}return n.tmpl(n.tmpls.categories,{id:t?this.prefix+("-sub-"+t):"",out:i})}},currency:{$el:null,init:function(){var e;this.$el=n.dom.$("#digiseller-currency");if(!this.$el){return}this.$el.innerHTML=n.tmpls.currency;e=n.dom.$("select",this.$el)[0];n.dom.addEvent(e,"change",function(e){var t;t=n.dom.attr(this,"data-type");n.opts.currency=n.dom.select(this);n.util.cookie.set("digiseller-currency",n.opts.currency);n.historyClick.reload()});n.dom.select(e,n.opts.currency)}},pager:function(){function e(e,t){this.$el=e;t=t||{};this.page=t.page||1;this.rows=t.rows||10;this.total=t.total||0;this.opts={tmpl:t.tmpl||n.tmpls.pages,max:t.max||2,getLink:t.getLink||function(e){return e},onChangeRows:t.onChangeRows||function(e){}};return}e.prototype.mark=function(){var e,t,r,i,s;r=n.dom.$("a",this.$el);for(e=i=0,s=r.length;i<s;e=++i){t=r[e];n.dom.klass(this.page===parseInt(n.dom.attr(t,"data-page"))?"add":"remove",t,"digiseller-activepage")}return this};e.prototype.render=function(){var e,t,r,i,s,o;this.page=parseInt(this.page);this.rows=parseInt(this.rows);this.total=parseInt(this.total);this.$el.style.display=this.total?"":"none";t=this.page-this.opts.max;t=t<1?1:t;s=this.page+this.opts.max;s=s>this.total?this.total:s;i=t;r="";while(i<=s){r+=this.opts.getLink(i);i++}if(t>1){r=this.opts.getLink(1)+(t>2?"<span>...</span> ":"")+r}if(s<this.total){r=r+(s<this.total-1?"<span>...</span> ":"")+this.opts.getLink(this.total)}this.$el.innerHTML=n.tmpl(this.opts.tmpl,{out:r});o=this;e=n.dom.$("select",this.$el)[0];n.dom.addEvent(e,"change",function(e){o.rows=n.dom.select(this);return o.opts.onChangeRows(o.rows)});n.dom.select(e,this.rows);this.mark();return this};return e}(),comments:function(){function e(e,t,n){this.$el=e;this.product_id=t;this.init=n;this.isInited=false;this.type="";this.page=1;this.rows=10;this.pager=null;return}e.prototype.get=function(){var e;e=this;n.JSONP.get(n.opts.host+"shop_reviews.asp",this.$el,{seller_id:n.opts.seller_id,product_id:this.product_id,format:"json",type:this.type,page:this.page,rows:this.rows},function(t){if(!t){return false}e.render(t)})};e.prototype.render=function(e){var t,r,i,s,o;r=e.review;i="";if(!r){i=n.tmpls.nothing}else{for(s=0,o=r.length;s<o;s++){t=r[s];i+=n.tmpl(n.tmpls.comment,{d:t})}}if(this.isInited){this.pager.page=this.page;this.pager.rows=this.rows;this.pager.total=e.totalPages;this.pager.render()}else{this.init(e);this.container=n.dom.$(".digiseller-comments",this.$el)[0];this.isInited=true}this.container.innerHTML=i};return e}(),calc:function(){function r(r){var i,s,o,u,a;this.id=r;this.$={container:n.dom.$("#"+t)};if(!this.$.container){return}for(u=0,a=e.length;u<a;u++){i=e[u];this.$[i]=n.dom.$("#"+t+"-"+i)}o=this;if(this.$.amount){if(this.$.cnt){n.dom.addEvent(this.$.amount,"keyup",function(){return o.get("amount")});n.dom.addEvent(this.$.cnt,"keyup",function(){return o.get("cnt")})}if(this.$.cntSelect){n.dom.addEvent(this.$.cntSelect,"change",function(){return o.get("cnt")})}}n.dom.addEvent(this.$.currency,"change",function(){if(o.$.amount){return o.get()}else if(o.$.price){return o.$.price.innerHTML=n.dom.attr(n.dom.$("option",o.$.currency)[o.$.currency.selectedIndex],"data-price")}});s=function(e){if(o.$.rules){return n.dom.klass(e&&!o.$.rules.checked?"add":"remove",o.$.rules.parentNode,"digiseller-calc-confirmation-error")}};n.dom.addEvent(this.$.buy,"mouseover",function(){return s(true)});n.dom.addEvent(this.$.buy,"mouseout",function(){return s(false)});return}var e,t;e=["amount","cnt","cntSelect","currency","amountR","price","buy","limit","rules"];t="digiseller-calc";r.prototype.get=function(e){var t,r;r=this;t={product_id:this.id,format:"json"};if(e==="amount"){t.amount=this.$.amount.value}else{t.cnt=this.$.cntSelect?n.dom.select(this.$.cntSelect):this.$.cnt.value;this.checkMinMax(t.cnt)}t.currency=n.dom.select(this.$.currency);n.JSONP.get(n.opts.host+"shop_unit.asp",this.$.container,t,function(e){if(!e){return false}r.render(e.prices_unit)})};r.prototype.checkMinMax=function(e){var t,r,i,s;s=this;e=parseInt(e);t=parseInt(n.dom.attr(this.$.buy,"data-max"));r=parseInt(n.dom.attr(this.$.buy,"data-min"));i=function(e,t){s.$.limit.style.display="";n.dom.attr(s.$.buy,"data-action","");return s.$.limit.innerHTML=n.tmpl(n.tmpls.minmax,{val:e,flag:t})};if(t&&e>t){i(t,true);return}else if(r&&e<r){i(r,false);return}n.dom.attr(this.$.buy,"data-action","buy");this.$.limit.style.display="none"};r.prototype.render=function(e){if(!e){return false}if(e.unit_Amount){this.$.amount.value=e.unit_Amount}if(this.$.cnt&&e.unit_Cnt){this.checkMinMax(e.unit_Cnt);this.$.cnt.value=e.unit_Cnt}if(this.$.cntSelect&&e.unit_Currency){n.dom.select(this.$.cntSelect,e.unit_Currency)}this.$.amountR.innerHTML=e.unit_AmountDesc};return r}()};n.route={home:{url:"/home",action:function(){n.widget.category.mark();this.get()},get:function(){var e;e=this;n.JSONP.get(n.opts.host+"shop_products.asp",n.widget.main.$el,{seller_id:n.opts.seller_id,category_id:0,rows:10,format:"json",order:n.opts.sort,currency:n.opts.currency},function(t){if(!t){return false}e.render(t);n.util.scrollUp()})},render:function(e){var t,r,i,s,o;i="";r=e.product;if(r&&r.length){for(s=0,o=r.length;s<o;s++){t=r[s];i+=n.tmpl(n.tmpls["article"+n.opts.main_view.charAt(0).toUpperCase()+n.opts.main_view.slice(1)],{d:t,url:n.opts.hashPrefix+("/detail/"+t.id),imgsize:n.opts.main_view==="tile"?n.opts.imgsize_firstpage:n.opts.imgsize_listpage})}}return n.widget.main.$el.innerHTML=n.tmpl(n.tmpls.showcaseArticles,{out:n.opts.main_view==="table"?'<table class="digiseller-table">'+i+"</table>":i,categories:e.categories,opts:n.opts})}},search:{url:"/search(?:/([0-9]*))?\\?s=(.*)",search:null,page:null,rows:null,pager:null,prefix:"digiseller-search",action:function(e){this.search=decodeURIComponent(e[2]);this.page=parseInt(e[1])||1;this.rows=n.opts.rows;n.widget.category.mark();n.widget.search.$input.value=this.search;this.get()},get:function(){var e;e=this;n.JSONP.get(n.opts.host+"shop_search.asp",n.widget.main.$el,{seller_id:n.opts.seller_id,format:"json",currency:n.opts.currency,page:this.page,rows:this.rows,search:this.search},function(t){if(!t){return false}e.render(t);n.util.scrollUp()})},render:function(e){var t,r,i,s,o,u,a;s="";r=e.product;if(!r||!r.length){s=n.tmpls.nothing}else{for(u=0,a=r.length;u<a;u++){t=r[u];s+=n.tmpl(n.tmpls.searchResult,{url:n.opts.hashPrefix+("/detail/"+t.id),imgsize:n.opts.imgsize_listpage,d:t})}}i=n.dom.$("#"+this.prefix+"-results");if(i){i.innerHTML=s;this.pager.page=this.page;this.pager.rows=this.rows;this.pager.total=e.totalPages;this.pager.render()}else{n.widget.main.$el.innerHTML=n.tmpl(n.tmpls.searchResults,{totalItems:e.totalItems,out:s});o=this;this.pager=(new n.widget.pager(n.dom.$(".digiseller-paging",n.widget.main.$el)[0],{page:this.page,rows:this.rows,total:e.totalPages,getLink:function(e){return n.tmpl(n.tmpls.page,{page:e,url:n.opts.hashPrefix+("/search/"+e+"?s="+o.search)})},onChangeRows:function(e){n.opts.rows=e;n.util.cookie.set(n.route.articles.prefix+"-rows",e);o.page=1;o.rows=e;o.get();n.historyClick.changeHashSilent(n.opts.hashPrefix+("/search/1?s="+o.search))}})).render();n.widget.currency.init()}n.dom.$("#"+this.prefix+"-query").innerHTML=this.search.replace("<","&lt;").replace(">","&gt;");n.dom.$("#"+this.prefix+"-total").innerHTML=e.totalItems}},articles:{url:"/articles/([0-9]*)(?:/([0-9]*))?",cid:null,page:1,rows:null,pager:null,pagerComments:null,prefix:"digiseller-articles",action:function(e){this.cid=e[1];this.page=parseInt(e[2])||1;this.rows=n.opts.rows;this.get()},get:function(){var e;n.widget.category.mark(this.cid);e=this;n.JSONP.get(n.opts.host+"shop_products.asp",n.widget.main.$el,{seller_id:n.opts.seller_id,format:"json",category_id:this.cid,page:this.page,rows:this.rows,order:n.opts.sort,currency:n.opts.currency},function(t){if(!t){return false}e.render(t);n.util.scrollUp()})},render:function(e){var t,r,i,s,o,u,a,f,l,c,h,p;s="";e.totalPages=parseInt(e.totalPages);r=e.product;if(!r||!r.length){s=n.tmpls.nothing}else{for(l=0,h=r.length;l<h;l++){t=r[l];s+=n.tmpl(n.tmpls["article"+n.opts.view.charAt(0).toUpperCase()+n.opts.view.slice(1)],{d:t,url:n.opts.hashPrefix+("/detail/"+t.id),imgsize:n.opts.view==="tile"?n.opts.imgsize_firstpage:n.opts.imgsize_listpage})}}i=n.dom.$("#"+this.prefix+"-"+this.cid);if(i){i.innerHTML=n.opts.view==="table"?'<table class="digiseller-table">'+s+"</table>":s;this.pager.page=this.page;this.pager.rows=this.rows;this.pager.total=e.totalPages;this.pager.render()}else{n.widget.main.$el.innerHTML=n.tmpl(n.tmpls.articles,{id:this.prefix+"-"+this.cid,opts:n.opts,d:e,hasCategories:!e.categories||!e.categories.length?false:true,articlesPanel:e.totalPages?n.tmpls.articlesPanel:"",out:s});if(e.totalPages){f=this;this.pager=(new n.widget.pager(n.dom.$("."+this.prefix+"-pager",n.widget.main.$el)[0],{page:this.page,rows:this.rows,total:e.totalPages,getLink:function(e){return n.tmpl(n.tmpls.page,{page:e,url:n.opts.hashPrefix+("/articles/"+f.cid+"/"+e)})},onChangeRows:function(e){n.opts.rows=e;n.util.cookie.set(f.prefix+"-rows",e);f.page=1;f.rows=e;f.get();n.historyClick.changeHashSilent(n.opts.hashPrefix+("/articles/"+f.cid+"/1"))}})).render();n.widget.currency.init();a=function(e){var t;t=n.dom.$("select",n.dom.$("#digiseller-"+e))[0];n.dom.addEvent(t,"change",function(t){n.opts[e]=n.dom.select(this);n.util.cookie.set(f.prefix+("-"+e),n.opts[e]);return f.get()});return n.dom.select(t,n.opts[e])};u=["sort","view"];for(c=0,p=u.length;c<p;c++){o=u[c];a(o)}}}}},article:{url:"/detail(?:/([0-9]*))",comments:null,id:null,prefix:"digiseller-article",action:function(e){var t;this.id=e[1]||0;t=this;n.JSONP.get(n.opts.host+"shop_product_info.asp",n.widget.main.$el,{seller_id:n.opts.seller_id,format:"json",product_id:this.id,currency:n.opts.currency},function(e){if(!e){return false}t.render(e);n.util.scrollUp()})},render:function(t){var r,i,s,o,u,a,f,l;if(!t||!t.product){n.widget.main.$el.innerHTML=n.tmpls.nothing;return}n.widget.category.mark(t.product.category_id);n.widget.main.$el.innerHTML=n.tmpl(n.tmpls.articleDetail,{d:t.product,opts:n.opts,buy:n.tmpl(n.tmpls.buy,{d:t.product,opts:n.opts,failPage:e.location,agree:n.opts.agree})});new n.widget.calc(t.product.id,t.product.prices_unit);n.widget.currency.init();u=this;r=n.dom.$("#"+this.prefix+"-img-preview");if(r){o=function(e){var t,r;r=n.dom.attr(e,"data-type");t=r==="img"?n.dom.attr(e,"href"):n.dom.attr(e,"data-id");n.popup.open(r,r==="img"?t:n.tmpl(n.tmpls.video,{id:t,type:r}),s.children.length&&e.previousSibling?function(){return o(e.previousSibling)}:false,s.children.length&&e.nextSibling?function(){return o(e.nextSibling)}:false)};s=n.dom.$("#"+this.prefix+"-thumbs");l=s.children;for(a=0,f=l.length;a<f;a++){i=l[a];n.dom.addEvent(i,"click",function(e){n.util.prevent(e);return o(this)})}n.dom.addEvent(r,"click",function(e){n.util.prevent(e);return o(s.children.length?s.children[0]:this)})}},initComments:function(e){var t,r;t=n.dom.$("#"+this.prefix+"-comments-"+this.id);if(n.dom.attr(t,"inited")){if(e){e()}return}r=this;this.comments=new n.widget.comments(t,this.id,function(i){var s;n.dom.attr(t,"inited",1);r.comments.$el.innerHTML=n.tmpl(n.tmpls.comments,{totalGood:i.totalGood,totalBad:i.totalBad});if(e){e()}s=n.dom.$("select",t)[0];n.dom.addEvent(s,"change",function(e){r.comments.page=1;r.comments.type=n.dom.$("option",this)[this.selectedIndex].value;return r.comments.get()});r.comments.pager=(new n.widget.pager(n.dom.$(".digiseller-paging",r.comments.$el)[0],{page:r.comments.page,rows:r.comments.rows,total:i.totalPages,getLink:function(e){return n.tmpl(n.tmpls.pageComment,{page:e,url:"#"})},onChangeRows:function(e){n.util.cookie.set("digiseller-comments-rows",e);r.comments.page=1;r.comments.rows=e;r.comments.get()}})).render()});this.comments.rows=n.util.cookie.get("digiseller-comments-rows")||10;this.comments.get()}},reviews:{url:"/reviews(?:/([0-9]*))?",comments:null,id:"",prefix:"digiseller-reviews",action:function(e){var t;if(!n.dom.$("#"+this.id)){this.id=this.prefix+("-"+n.util.getUID());t=this;this.comments=new n.widget.comments(n.widget.main.$el,"",function(e){t.initComments(e);return n.util.scrollUp()})}this.comments.page=parseInt(e[1])||1;this.comments.rows=n.util.cookie.get(this.prefix+"-rows")||10;this.comments.get()},initComments:function(e){var t;this.comments.$el.innerHTML=n.tmpl(n.tmpls.reviews,{id:this.id,totalGood:e.totalGood,totalBad:e.totalBad});t=this;this.comments.pager=(new n.widget.pager(n.dom.$(".digiseller-paging",this.comments.$el)[0],{page:this.comments.page,rows:this.comments.rows,total:e.totalPages,getLink:function(e){return n.tmpl(n.tmpls.pageReview,{page:e,url:"#!digiseller/reviews/"+e})},onChangeRows:function(e){n.util.cookie.set(this.prefix+"-rows",e);t.comments.page=1;t.comments.rows=e;t.comments.get()}})).render();n.dom.addEvent(n.dom.$("select",n.dom.$("#"+this.prefix+"-type"))[0],"change",function(e){t.comments.page=1;t.comments.type=n.dom.$("option",this)[this.selectedIndex].value;return t.comments.get()})}},contacts:{url:"/contacts",action:function(e){var t;t=this;n.JSONP.get(n.opts.host+"shop_contacts.asp",n.widget.main.$el,{seller_id:n.opts.seller_id,format:"json"},function(e){if(!e){false}n.widget.main.$el.innerHTML=n.tmpl(n.tmpls.contacts,{d:e});n.util.scrollUp()})}}};n.events={"click-comments-page":function(e,t){var r;n.util.prevent(t);r=n.dom.attr(e,"data-page");n.route.article.comments.page=r;n.route.article.comments.get()},"click-buy":function(t,r){var i,s,o,u;n.util.prevent(r);u=n.dom.attr(t,"data-id");o=n.dom.attr(t,"data-form");if(o){i=n.dom.$("#digiseller-calc-rules");if(i){n.opts.agree=i.checked?1:0;n.util.cookie.set("digiseller-agree",n.opts.agree);if(!i.checked){return}}n.dom.$("#digiseller-buy-form-"+u).submit()}else{s=function(){return e.open("https://www.oplata.info/asp/pay_x20.asp?id_d="+u+"&dsn=limit","_blank")};if(n.opts.agreement_text){n.popup.open("text",n.tmpl(n.tmpls.agreement,{text:n.opts.agreement_text}));n.dom.addEvent(n.dom.$("#digiseller-agree"),"click",function(){return n.util.agree(true,s)});n.dom.addEvent(n.dom.$("#digiseller-disagree"),"click",function(){return n.util.agree(false)})}else{s()}}},"click-article-tab":function(e,t){var r,i,s;n.util.prevent(t);s=n.dom.attr(e,"data-tab");r=e.parentNode.nextSibling.children;n.dom.klass("remove",e.parentNode.children,"digiseller-activeTab",true);n.dom.klass("add",e,"digiseller-activeTab");i=function(){var e,t,n;for(t=0,n=r.length;t<n;t++){e=r[t];e.style.display="none"}return r[s].style.display=""};if(s==="2"){n.route.article.initComments(i)}else{i()}},"click-share":function(t,r){var i,s,o;o=n.dom.attr(t,"data-type");s=n.dom.attr(t,"data-title");i=n.dom.attr(t,"data-img");if(n.share[o]){e.open(n.share[o](s,i),"digisellerShare_"+o,n.util.getPopupParams(626,436))}},"click-agreement":function(e,t){n.util.prevent(t);n.popup.open("text",n.tmpl(n.tmpls.agreement,{text:n.opts.agreement_text}));n.dom.addEvent(n.dom.$("#digiseller-agree"),"click",function(){return n.util.agree(true)});return n.dom.addEvent(n.dom.$("#digiseller-disagree"),"click",function(){return n.util.agree(false)})}};n.share={vk:function(e,r){return"//vkontakte.ru/share.php?url="+n.util.enc(t.location)+"&title="+n.util.enc(e)+"&image="+n.util.enc(r)+"&noparse=true"},tw:function(e){return"//twitter.com/share?text="+n.util.enc(e)+"&url="+n.util.enc(t.location)},fb:function(e,r){return"//www.facebook.com/sharer.php?s=100&p[url]="+n.util.enc(t.location)+"&p[title]="+n.util.enc(e)+"&p[images][0]="+n.util.enc(r)},wme:function(e,r){return"//events.webmoney.ru/sharer.aspx?url="+n.util.enc(t.location)+"&title="+n.util.enc(e)+"&image="+n.util.enc(r)+"&noparse=0"}};n.historyClick=function(){function s(){if(!a.interval){a.interval=setInterval(o,100)}}function o(){var r=false;if(n){r=true}if(e.location.hash!==a.currentHash||n){a.prevHash=n?a.prevHash:a.currentHash;a.currentHash=e.location.hash.toString();u(a.currentHash&&a.currentHash!="#"?a.currentHash:t);if(r){n=false}}}function u(e){if(!e){return}var t,n;for(var r=0,s=i.length;r<s;r++){t=i[r][0];n=i[r][1];if(t.test(e)&&typeof n==="function"){a.params=e.match(t);n(a.params);return}}}var t="",n=false,r=[],i=[];var a={interval:null,currentHash:"",prevHash:"",params:[],start:function(){s()},rootAlias:function(e){if(e){t=e}else{return t}},addRoute:function(e,t){if(typeof e==="string"){e=[e]}for(var n=0;n<e.length;n++){r.push([new RegExp(e[n],"i"),t])}i=r.slice().reverse()},reload:function(){n=true},changeHashSilent:function(t){a.prevHash=a.currentHash;a.currentHash=e.location.hash=t}};return a}();n.JSONP=function(){function t(t,r,i,s){var o=(t||"").indexOf("?")===-1?"?":"&",u;i=i||{};var a=n.util.getUID();i.queryId=a;for(u in i){if(!i.hasOwnProperty(u)){continue}o+=n.util.enc(u)+"="+n.util.enc(i[u])+"&"}var f=r?true:false;if(f){n.dom.attr(r,"data-qid",a)}e[a]=function(e){if(f&&(!r||e.queryId!=n.dom.attr(r,"data-qid"))){return}s(e)};n.dom.getScript(t+o+"_"+Math.random());return a}var e=[];return{get:t,callback:function(t){if(!t||!t.queryId||!e[t.queryId]){return}e[t.queryId](t);try{delete e[t.queryId]}catch(n){}e[t.queryId]=null}}}();n.tmpl=function(e,t){settings={evaluate:/<\?([\s\S]+?)\?>/g,interpolate:/<\?=([\s\S]+?)\?>/g,escape:/<\?-([\s\S]+?)\?>/g};var n=/(.)^/;var r=new RegExp([(settings.escape||n).source,(settings.interpolate||n).source,(settings.evaluate||n).source].join("|")+"|$","g");var i=0,s="__p+='",o=/\\|'|\r|\n|\t|\u2028|\u2029/g,u={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};e.replace(r,function(t,n,r,a,f){s+=e.slice(i,f).replace(o,function(e){return"\\"+u[e]});s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":a?"';\n"+a+"\n__p+='":"";i=f+t.length});s+="';\n";if(!settings.variable){s="with(obj||{}){\n"+s+"}\n"}s="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var a=new Function(settings.variable||"obj",s)}catch(f){f.source=s;throw f}if(t){return a(t)}var l=function(e){return a.call(this,e)};l.source="function("+(settings.variable||"obj")+"){\n"+s+"}";return l};n.popup=function(){var r,i,s,o,u,a,f,l,c,h,p,d;h={};i=null;f="digiseller-popup-";u=t.compatMode==="CSS1Compat";d=null;a=null;c=null;o=true;p=function(t){h.$loader.style.display="none";h.$container.style.display="";d=n.dom.addEvent(e,"resize",t);t()};r=function(t){if(t){n.util.prevent(t)}h.$img.innerHTML="";h.$main.style.display="none";n.dom.removeEvent(e,"resize",d);o=true;i=null};l=function(n,r,s){var o,a,f,l,c,p,d,v,m,g,y;m=e.innerHeight;l=(typeof m!=="undefined"?m:t[u?"documentElement":"body"].offsetHeight-22)-100;if(!s){p=n/r;g=e.innerWidth;y=(typeof g!=="undefined"?g:t[u?"documentElement":"body"].offsetWidth)-120;f=l;v=y;c=false;n>=l&&(c=true)||(f=n);r>=y&&(c=true)||(v=r);if(c){if(p<=f/v){f=Math.round(p*v)}else{v=Math.round(f/p)}}i.style.height=f+"px";i.style.width=v+"px"}h.$container.style.width=(s?r:v)+50+"px";a=t.documentElement;o=t.body;d=a&&a.scrollTop||o&&o.scrollTop||0;h.$container.style.top=(l-(s?n:f)+20)/3+d+"px"};s=function(){var e,i,s,o,u;e=t.createElement("div");e.innerHTML=n.tmpl(n.tmpls.popup,{p:f});(t.getElementsByTagName("body")[0]||t.documentElement).appendChild(e.firstChild);s=["main","fade","loader","container","close","img","left","right"];for(o=0,u=s.length;o<u;o++){i=s[o];h["$"+i]=t.getElementById(f+i)}n.dom.addEvent(h.$fade,"click",r);n.dom.addEvent(h.$close,"click",r)};return{open:function(t,r,u,f){!h.$main&&s();o=false;h.$container.style.display="none";h.$main.style.display="";h.$loader.style.display="";h.$left.style.display=u?"":"none";if(u){n.dom.removeEvent(h.$left,"click",a);a=n.dom.addEvent(h.$left,"click",u)}h.$right.style.display=f?"":"none";if(f){n.dom.removeEvent(h.$right,"click",c);c=n.dom.addEvent(h.$right,"click",f)}switch(t){case"img":n.dom.klass("remove",h.$img,"digiseller-popup-video");i=new Image;i.onload=function(){var t,r;if(o){return}t=i.height;r=i.width;n.dom.removeEvent(e,"resize",d);p(function(){l(t,r)});h.$img.innerHTML="";return h.$img.appendChild(i)};i.src=r;break;default:n.dom.klass("add",h.$img,"digiseller-popup-video");p(function(){l(200,500,true)});h.$img.innerHTML=r}},close:r}}();r=false;n.init=function(){if(r){return false}r=true;n.$el.head=n.dom.$("head")[0]||t.documentElement;n.$el.body=n.dom.$("body")[0]||t.documentElement;n.dom.getStyle(n.opts.host+"shop_css.asp?seller_id="+n.opts.seller_id,function(){var t,r,i,s,o,u,a,f,l,c,h;n.opts.currency=n.util.cookie.get("digiseller-currency")||n.opts.currency;s=["sort","rows","view"];for(a=0,f=s.length;a<f;a++){i=s[a];n.opts[i]=n.util.cookie.get(n.route.articles.prefix+"-"+i)||n.opts[i]}n.opts.agree=n.util.cookie.get("digiseller-agree")||n.opts.agree;n.widget.category.init();n.widget.main.init();n.widget.loader.init();n.widget.search.init();if((l=n.dom.$("#digiseller-logo"))!=null){l.innerHTML=n.tmpl(n.tmpls.logo,{logo_img:n.opts.logo_img})}if((c=n.dom.$("#digiseller-topmenu"))!=null){c.innerHTML=n.tmpl(n.tmpls.topmenu,{d:n.opts})}if(!n.widget.category.$el){n.widget.main.$el.className="digiseller-main-nocategory"}t=false;n.historyClick.addRoute("#.*",function(e){if(t){return}t=true;n.route.home.action()});h=n.route;u=function(e){n.historyClick.addRoute(n.opts.hashPrefix+e.url,function(n){t=true;e.action(n)})};for(r in h){o=h[r];if(!(n.route.hasOwnProperty(r)||o.url||o.action)){continue}u(o)}n.historyClick.rootAlias(n.opts.hashPrefix+"/home");n.historyClick.start();if(e.location.hash===""){n.historyClick.reload()}})};e.DigiSeller=n;n.dom.addEvent(e,"load",n.init)})(window,document)}).call(this);